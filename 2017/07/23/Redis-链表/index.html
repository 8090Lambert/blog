<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content=""><meta name="author" content="8090Lambert"><meta name="google-site-verification" content="NlVkPYQIz-6FEWSYj-zlvN-gVromFNmq2v7hUK_WyyM"><meta name="sogou_site_verification" content="GFRFxFpBEM"><meta property="og:title" content="Redis-链表"><meta property="og:description" content="A Programmer With Coding."><meta property="og:site_name" content="8090Lambert | Blog"><meta property="og:type" content="article"><meta property="og:image" content="http://8090lambert.cn"><link rel="alternate" href="/atom.xml" title="8090Lambert | Blog" type="application/atom+xml"><link rel="icon" href="/images/favicon.ico"><title>8090Lambert | Blog</title><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-146263529-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script>var _hmt=_hmt||[]</script><script async src="//hm.baidu.com/hm.js?dfc9714182f4393d85cb19cc7ad9c231"></script></head><body><nav class="navbar-custom navbar-fixed-top"><div class="container-fluid"><div class="collapse navbar-collapse site-menu"><ul class="nav navbar-nav navbar-right"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/about">About</a></li><li> <a href="mailto:<juzs215@gmail.com>">Email</a></li><li><a href="https://github.com/8090Lambert"><i class="icon fa fa-github fa-lg"></i></a></li></ul></div></div></nav><header class="site-header header-background intro-header" style="background-image:url(/img/banner.jpg)"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="page-title with-background-image"><p class="title">Redis-链表</p><p class="subtitle"></p></div></div></div></div></header><article><div class="container typo"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-info text-muted"> <span class="author info">By 8090Lambert</span> <span class="date-time info">On <span class="date">2017-07-23T22:21:37+08:00</span></span></div><div class="post-tags text-muted"> Tags: <a class="tag" href="/tags/redis/">#redis</a></div><div class="post-content"><p>链表是一种基本的数据结构，它是由一系列的节点组成，每个节点上都包括有两部分数据：一个是存储数据元素的数据域，一个是存储下一个节点地址的指针域。新增节点时，可以做到O(1)的复杂度。链表一般分为：单向链表、双向链表、循环链表。Redis 的链表，属于双向链表。</p><p>链表中节点结构体在文件 <code>src/adlist.h</code> 如下：</p><pre><code class="angular2html">typedef struct listNode {
    struct listNode *prev;
    struct listNode *next;
    void *value;
} listNode;
</code></pre><p>其中 <code>prev</code> 指向当前节点的上一个节点，<code>next</code> 指向当前节点的下一个节点；<code>value</code> 用来存储当前节点的数据，其中 <code>prev</code> 和 <code>next</code> 共同组成了链表的指针域，<code>value</code> 则是它的数据域，因为是 <code>void *</code>，所以可以在节点中存储任意的数据类型。</p><p>多个 <code>listNode</code> 通过 <code>prev</code> 和 <code>next</code> 就可以组成一个双向链表。但是 Redis 还是决定用一个结构体来管理链表。这是它的结构体：</p><pre><code class="angular2html">typedef struct list {
    listNode *head;     // 表头节点
    listNode *tail;     // 表尾节点
    void *(*dup)(void *ptr);    // 节点复制函数
    void (*free)(void *ptr);    // 节点释放函数
    int (*match)(void *ptr, void *key);     // 节点对比函数
    unsigned long len;  // 链表长度
} list;
</code></pre><p><code>head</code>、<code>tail</code> 和 <code>len</code> 就不多做介绍了，<code>dup</code>、<code>free</code> 和 <code>match</code> 主要是实现多态链表的函数，因为 <code>listNode</code> 的 <code>value</code> 可以存储任意类型的数据，在复制、释放或者比较时，对于不同的类型，需要有不同的操作，所以，在生成链表时，需要对应的set每种类型的操作（复制、释放和对比）API。<br>在 <code>src/adlist.h</code> 64行开始，有6个宏定义的方法，作为 <code>setter</code> 和 <code>getter</code>。</p><pre><code class="angular2html">#define listSetDupMethod(l,m) ((l)-&gt;dup = (m))
#define listSetFreeMethod(l,m) ((l)-&gt;free = (m))
#define listSetMatchMethod(l,m) ((l)-&gt;match = (m))

#define listGetDupMethod(l) ((l)-&gt;dup)
#define listGetFree(l) ((l)-&gt;free)
#define listGetMatchMethod(l) ((l)-&gt;match)
</code></pre><p>对于链表结构，获取前一个节点和后一个节点的复杂度都是O(1)，因为有 <code>len</code> 属性，所以获取链表长度复杂度也是O(1)。在网上找了些文章，在 <code>list</code> 的实现，主要就用到了链表，其实可以想到，因为 <code>list</code> 本身就是一个链表的结构。</p><p><code>aslist.h</code> 文件中还有一个结构体</p><pre><code class="angular2html">typedef struct listIter {
    listNode *next;
    int direction;
} listIter;
</code></pre><p>这个是 <code>list</code> 的迭代器，<code>next</code> 指针指向下个节点，<code>direction</code> 是定义迭代的方向，<code>AL_START_HEAD</code> 和 <code>AL_START_TAIL</code> 分别对应从头部 -&gt; 尾部的方向、尾部 -&gt; 头部的方向。相关的方法有：</p><pre><code class="angular2html">listIter *listGetIterator(list *list, int direction)    // 初始化一个 链表迭代器

listNode *listNext(listIter *iter)  // 迭代器 next 方法

void listReleaseIterator(listIter *iter);   // 迭代器释放

void listRewind(list *list, listIter *li);  // 迭代器恢复指针至表头位置

void listRewindTail(list *list, listIter *li);  // 迭代器恢复指针至表尾位置
</code></pre></div><section class="comments" id="comments"><div id="gitment_thread"></div><link rel="stylesheet" href="//unpkg.com/gitment/style/default.css"><script src="//unpkg.com/gitment/dist/gitment.browser.js"></script><script>var gitment=new Gitment({id:"{{ page.date }}",owner:"8090Lambert",repo:"8090Lambert.github.io",oauth:{client_id:"b2e729afbaa762a4cecc",client_secret:"cb9b28cda56154edecbcf76d2ea66e5a0e12c209"}});gitment.render("comments")</script></section></div></div></div></article><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><p class="copyright text-muted"> &copy; 2016 - 2021<span class="with-love"><i class="fa fa-heart"></i></span> <span class="author">8090Lambert</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></p><p class="visit-statistics"> <span id="busuanzi_container_site_pv">本站总访问：<span id="busuanzi_value_site_pv"></span>次 &nbsp;&nbsp;&nbsp;&nbsp;</span></p><p></p></div></div></div></footer><script src="/js/highlight.pack.js"></script><script>document.addEventListener("DOMContentLoaded",function(e){Array.prototype.slice.call(document.getElementsByTagName("pre")).forEach(function(e,t){hljs.highlightBlock(e)})})</script></body></html>